<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>{% block title %}The Narrative{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ css_path }}site.css">
  <link rel="stylesheet" href="{{ css_path }}index.css">
  <link rel="stylesheet" href="{{ css_path }}calendar.css">
  {% block extra_css %}{% endblock %}
</head>

<body data-photo-index-url="{{ photo_index_url | default('') }}" data-archive-root="./">

  <!-- Large banner (first load) -->
  <header class="hero-header">
    <h1>The Narrative</h1>
    <p class="subtitle">{{ year_range | default('') }}</p>
  </header>

  <!-- Wrapper so compact header can stick; hidden until hero scrolls out (JS toggles .hero-out) -->
  <div class="main-wrap">
    <div class="compact-header-wrap">
      <header class="compact-header">
        <h1>The Narrative</h1>
      </header>
    </div>

    <!-- White content area with subtle rounded top; holds tabs + main content -->
    <div class="content-sheet">
      <nav class="tabs" aria-label="View">
        <a href="{{ tab_urls.index_url }}" class="tab{% if active_tab == 'list' %} is-active{% endif %}">List</a>
        <a href="{{ tab_urls.calendar_url }}" class="tab{% if active_tab == 'calendar' %} is-active{% endif %}">Calendar</a>
        <a href="{{ tab_urls.media_url }}" class="tab{% if active_tab == 'media' %} is-active{% endif %}">Media</a>
        <a href="{{ tab_urls.map_url }}" class="tab{% if active_tab == 'map' %} is-active{% endif %}">Map</a>
        <a href="{{ tab_urls.search_url }}" class="tab{% if active_tab == 'search' %} is-active{% endif %}">Search</a>
      </nav>

      {% block content %}{% endblock %}
  </div>
  </div>

  <script src="{{ js_path }}nav.js"></script>
  <script>
    (function () {
      var hero = document.querySelector('.hero-header');
      if (!hero) return;
      var observer = new IntersectionObserver(function (entries) {
        var e = entries[0];
        document.body.classList.toggle('hero-out', !e.isIntersecting);
      }, { rootMargin: '0px', threshold: 0.20 });
      observer.observe(hero);
    })();

    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
  
    document.addEventListener('DOMContentLoaded', () => {
      const y = sessionStorage.getItem('indexScroll');
      if (y) window.scrollTo(0, parseInt(y, 10));
    });
  
    window.addEventListener('beforeunload', () => {
      sessionStorage.setItem('indexScroll', window.scrollY);
    });
  </script>
  
</body>

</html>